{% extends "base.html" %}

{% block title %}베팅 결과 승인 - SCUTTA{% endblock %}

{% block container_style %}margin-top: 0;{% endblock %}

{% block header_left %}
<a href="{{ url_for('index') }}" class="text-lg font-bold truncate">
    베팅 결과 승인
</a>
{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-sm">
    <h2 class="text-2xl font-bold mb-6">결과 대기 중인 베팅</h2>

    <div class="space-y-6">
        {% if pending_bettings %}
        {% for betting in pending_bettings %}
        <div class="border rounded-lg p-4 bg-gray-50">
            <div class="flex justify-between items-center mb-4">
                <span class="font-bold text-lg">{{ betting.title }}</span>
                <span class="text-sm text-gray-500">{{ betting.created_at.strftime('%Y-%m-%d') }}</span>
            </div>
            <div class="grid grid-cols-3 gap-4 text-center mb-4">
                <div class="font-semibold">{{ betting.p1_name }}</div>
                <div class="text-gray-400">vs</div>
                <div class="font-semibold">{{ betting.p2_name }}</div>
            </div>

            <form action="{{ url_for('approve_betting_result', betting_id=betting.id) }}" method="POST"
                class="border-t pt-4">
                <div class="flex items-center gap-4 mb-4 justify-center">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="winner_id" value="{{ betting.p1_id }}" required
                            class="form-radio text-blue-600">
                        <span>{{ betting.p1_name }} 승</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="winner_id" value="{{ betting.p2_id }}" required
                            class="form-radio text-red-600">
                        <span>{{ betting.p2_name }} 승</span>
                    </label>
                </div>
                <div class="flex gap-2">
                    <button type="submit"
                        class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition">
                        결과 확정 및 배당 지급
                    </button>
                    <button type="button" onclick="cancelBetting({{ betting.id }})"
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition">
                        베팅 취소
                    </button>
                </div>
            </form>
        </div>
        {% endfor %}
        {% else %}
        <div class="text-center py-12 text-gray-500 bg-gray-50 rounded-lg">
            <p>결과 승인 대기 중인 베팅이 없습니다.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function cancelBetting(bettingId) {
        if (confirm('정말 이 베팅을 취소하시겠습니까? (포인트가 환불됩니다)')) {
            // 베팅 취소 로직 (API 호출 or Form Submit)
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/admin/betting/cancel/${bettingId}`; // 가상의 URL
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
{% endblock %}
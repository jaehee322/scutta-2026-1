{% extends "base.html" %}

{% block title %}{{ _('베팅 참여') }} - {{ betting.p1_name }} vs {{ betting.p2_name }}{% endblock %}

{% block container_style %}margin-top: 0;{% endblock %}

{% block header_left %}
<a href="{{ url_for('betting.betting_page') }}" class="text-xl font-bold truncate">
    {{ betting.p1_name }} vs {{ betting.p2_name }}
</a>
{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-sm mb-6">
    <h3 class="text-xl font-bold mb-4">{{ _('상대 전적') }}</h3>

    <div class="flex justify-between items-center text-center p-4 bg-gray-50 rounded-lg mb-4">
        <div class="w-2/5">
            <p class="font-bold text-lg"><a href="/player/{{ betting.p1_id }}" class="hover:underline">{{
                    betting.p1_name }}</a></p>
            <p class="text-sm text-gray-500">{{ ranks.p1_rank or '무' }}부</p>
            <p class="text-md mt-1">{{ win_rate.p1_wins }}{{ _('승') }} {{ win_rate.p2_wins }}{{ _('패')}}</p>
        </div>
        <div class="w-1/5 text-gray-400 font-semibold">VS</div>
        <div class="w-2/5">
            <p class="font-bold text-lg"><a href="/player/{{ betting.p2_id }}" class="hover:underline">{{
                    betting.p2_name }}</a></p>
            <p class="text-sm text-gray-500">{{ ranks.p2_rank or '무' }}{{ _(부) }}</p>
            <p class="text-md mt-1">{{ win_rate.p2_wins }}{{ _('승')}} {{ win_rate.p1_wins }}{{ _('패')}}</p>
        </div>
    </div>

    <div class="overflow-x-auto">
        <table class="table-modern w-full">
            <thead>
                <tr>
                    <th class="text-left">{{ betting.p1_name }}</th>
                    <th class="text-center">{{ _('스코어') }}</th>
                    <th class="text-right">{{ betting.p2_name }}</th>
                </tr>
            </thead>
            <tbody>
                {% for match in recent_matches[:5] %}
                <tr>
                    <td class="text-left">
                        {% if match.winner == betting.p1_id %}<span class="font-bold text-green-600">{{ _('승')
                            }}</span>{% else %}{{ _('패') }}{% endif %}
                    </td>
                    <td class="text-center">{{ match.score }}</td>
                    <td class="text-right">
                        {% if match.winner == betting.p2_id %}<span class="font-bold text-green-600">{{ _('승')
                            }}</span>{% else %}{{ _('패') }}{% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" class="text-center text-gray-500 py-4">{{ _('상대 전적이 없습니다.') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="bg-white p-6 rounded-lg shadow-sm mb-6">
    {% if is_player %}
    <div class="text-center text-gray-500 font-semibold p-4 bg-gray-100 rounded-md">
        {{ _('자신의 경기에는 베팅할 수 없습니다.') }}
    </div>
    {% elif betting.is_closed %}
    <h3 class="text-xl font-bold mb-4">{{ _('나의 베팅') }}</h3>
    <div class="text-center text-gray-500 font-semibold p-4 bg-gray-100 rounded-md">
        {{ _('이 베팅은 마감되었습니다.') }}
    </div>
    {% else %}
    <form action="{{ url_for('betting.place_bet') }}" method="POST">
        <input type="hidden" name="betting_id" value="{{ betting.id }}">
        <h3 class="text-xl font-bold mb-4">{{ _('나의 베팅') }}</h3>
        <div class="space-y-4">
            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                <input type="radio" name="winner_id" value="{{ betting.p1_id }}" class="h-5 w-5 text-indigo-600" {% if
                    my_choice and my_choice.winner_id==betting.p1_id %}checked{% endif %} required>
                <span class="ml-4 text-lg font-semibold">{{ betting.p1_name }}</span>
            </label>
            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition">
                <input type="radio" name="winner_id" value="{{ betting.p2_id }}" class="h-5 w-5 text-indigo-600" {% if
                    my_choice and my_choice.winner_id==betting.p2_id %}checked{% endif %} required>
                <span class="ml-4 text-lg font-semibold">{{ betting.p2_name }}</span>
            </label>
        </div>
        <button type="submit" class="w-full bg-main button mt-6">
            {% if my_choice %}{{ _('베팅 변경하기') }}{% else %}{{ _('베팅하기') }}{% endif %} ({{ betting.point }}pt)
        </button>
    </form>
    {% endif %}
</div>

<div class="bg-white p-6 rounded-lg shadow-sm">
    <h3 class="text-xl font-bold mb-4">{{ _('베팅 현황') }}</h3>

    <div class="relative w-full my-6">
        <div class="flex h-2 rounded-full">
            <div class="bg-blue-500 rounded-l-full" style="width: {{ betting_stats.p1_percent }}%;"></div>
            <div class="bg-red-500 rounded-r-full" style="width: {{ betting_stats.p2_percent }}%;"></div>
        </div>
        <div class="absolute top-0 h-full flex items-center"
            style="left: {{ betting_stats.p1_percent }}%; transform: translateX(-50%);">
            <div class="text-red-500 text-2xl" style="transform: translateY(-55%);">
                <i class="fas fa-caret-down"></i>
            </div>
        </div>
    </div>

    <div class="flex justify-between items-start text-center mt-2">
        <div class="w-1/2">
            <p class="text-gray-500 text-sm">{{ betting.p1_name }}</p>
            <p class="font-bold text-lg">{{ "{:,}".format(betting_stats.p1_bettors) }}{{ _('명') }}</p>
        </div>
        <div class="w-1/2">
            <p class="text-gray-500 text-sm">{{ betting.p2_name }}</p>
            <p class="font-bold text-lg">{{ "{:,}".format(betting_stats.p2_bettors) }}{{ _('명') }}</p>
        </div>
    </div>
</div>
{% endblock %}
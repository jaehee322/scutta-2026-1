<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCUTTA {{ config.GLOBAL_TEXTS.semester }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-white text-gray-800">

    <header>
        <div class="flex items-center gap-4">
            <div id="menu-toggle" class="text-xl cursor-pointer">&#9776;</div>
            <a href="{{ url_for('index') }}" class="text-xl font-bold">SCUTTA</a>
        </div>
        <div class="flex items-center gap-4">
           {% if current_user.is_authenticated %}
                <a href="{{ url_for('mypage') }}" class="text-sm font-semibold hover:underline">{{ current_user.username }}</a>
                <a href="{{ url_for('logout') }}" class="bg-gray-200 hover:bg-gray-300 text-sm text-gray-800 py-1 px-3 rounded-md">로그아웃</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="text-sm font-semibold hover:underline">로그인</a>
           {% endif %}
        </div>
    </header>

    <div id="menu-overlay" class="menu-overlay"></div>
    <div id="menu" class="menu">
        <div class="menu-header">메뉴</div>
        <div class="menu-item" onclick="location.href='{{ url_for('mypage') }}'">마이페이지</div>
        <hr class="my-4" />
        <div class="menu-item" onclick="location.href='{{ url_for('submit_match_page') }}'">경기 결과 제출</div>
        <div class="menu-item" onclick="location.href='{{ url_for('my_submissions') }}'">나의 제출 현황</div>
        <div class="menu-item" onclick="location.href='{{ url_for('partner') }}'">오늘의 상대</div>
        <div class="menu-item" onclick="location.href='{{ url_for('league_or_tournament') }}'">리그전 및 토너먼트</div>
        <div class="menu-item" onclick="location.href='{{ url_for('betting') }}'">베팅</div>
        <hr class="mt-10" />
        <div class="menu-item mt-10">
            <a href="https://www.notion.so/scutta/SCUTTA-66ba5d3097404e0eade61cd7430bd740" target="_blank" rel="noopener noreferrer">NOTION</a>
        </div>
        <div class="menu-item" onclick="location.href='{{ url_for('password') }}'">관리 페이지로 이동</div>
    </div>

    <main class="container mx-auto p-4 md:p-6 lg:p-8">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}<div class="mb-4">{% for category, message in messages %}<div class="p-4 text-sm rounded-lg {% if category == 'error' %} bg-red-100 text-red-700 {% else %} bg-green-100 text-green-700 {% endif %}" role="alert"><span class="font-medium">{{ message }}</span></div>{% endfor %}</div>{% endif %}
        {% endwith %}

        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-light mb-4">SCUTTA</h2>
            <p class="text-gray-600 leading-relaxed">
                서울시립대학교 중앙 탁구 동아리 SCUTTA의 공식 기록 페이지입니다.<br>
                자신의 경기 기록을 제출하고, 동아리 내 랭킹을 확인하세요.
            </p>
        </section>
        
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-12">
            
            <div class="group block bg-gray-100 p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 border-b pb-2">경기 결과 제출</h3>
                <form action="{{ url_for('submit_match_direct') }}" method="POST" class="space-y-4">
                    <div>
                        <label class="text-sm font-bold text-gray-600">승리자</label>
                        <input type="text" name="winner_name" placeholder="승리자 이름 입력" class="w-full mt-1" required>
                    </div>
                    <div>
                        <label class="text-sm font-bold text-gray-600">패배자</label>
                        <input type="text" name="loser_name" placeholder="패배자 이름 입력" class="w-full mt-1" required>
                    </div>
                    <div>
                        <label class="text-sm font-bold text-gray-600">스코어</label>
                        <select name="score" class="w-full mt-1" required>
                            <option value="3:0">3:0</option>
                            <option value="2:1">2:1</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-main button mt-4">제출하기</button>
                </form>
                <a href="{{ url_for('my_submissions') }}" class="block w-full bg-gray-600 hover:bg-gray-700 text-white font-bold text-center py-2 px-4 rounded-lg transition mt-2">
                    최근 제출된 내 경기 보기
                </a>
            </div>

            <a href="{{ url_for('mypage') }}" class="group block bg-gray-100 hover:bg-gray-200 p-6 rounded-lg transition">
                <h3 class="text-xl font-semibold mb-2">마이페이지</h3>
                <span class="text-gray-500 group-hover:text-gray-700">바로가기 &rarr;</span>
            </a>
            <a href="{{ url_for('partner') }}" class="group block bg-gray-100 hover:bg-gray-200 p-6 rounded-lg transition">
                <h3 class="text-xl font-semibold mb-2">오늘의 상대</h3>
                <span class="text-gray-500 group-hover:text-gray-700">바로가기 &rarr;</span>
            </a>
            <a href="{{ url_for('betting') }}" class="group block bg-gray-100 hover:bg-gray-200 p-6 rounded-lg transition">
                <h3 class="text-xl font-semibold mb-2">베팅</h3>
                <span class="text-gray-500 group-hover:text-gray-700">바로가기 &rarr;</span>
            </a>
            <a href="{{ url_for('rankings_page') }}" class="group block bg-gray-100 hover:bg-gray-200 p-6 rounded-lg transition">
                <h3 class="text-xl font-semibold mb-2">전체 랭킹</h3>
                <span class="text-gray-500 group-hover:text-gray-700">바로가기 &rarr;</span>
            </a>
            <a href="{{ url_for('league_or_tournament') }}" class="group block bg-gray-100 hover:bg-gray-200 p-6 rounded-lg transition">
                <h3 class="text-xl font-semibold mb-2">리그전 및 토너먼트</h3>
                <span class="text-gray-500 group-hover:text-gray-700">바로가기 &rarr;</span>
            </a>
        </section>

        <section>
            <h2 class="text-2xl font-bold text-center mb-6">랭킹 요약</h2>
            <div class="flex overflow-x-auto space-x-4 pb-4 no-scrollbar">
                {% for title, players in rankings.items() %}
                <div class="bg-white rounded-lg shadow-sm p-4 flex-shrink-0" style="width: 280px;">
                    <h3 class="font-bold text-lg text-center mb-4">{{ title }}</h3>
                    <ul>
                        {% for player in players %}
                        <li class="flex items-center justify-between py-2 border-b last:border-b-0">
                            <div class="flex items-center">
                                <span class="font-bold w-6">{{ loop.index }}.</span>
                                <span>{{ player.name }} ({{ player.rank or '무' }})</span>
                            </div>
                            <span class="font-bold text-gray-700">
                                {{ player.value }}
                                {% if title == '승률' %}%{% endif %}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
            <div class="mt-6">
                <a href="{{ url_for('rankings_page') }}" class="block w-full bg-gray-200 text-gray-800 font-bold text-center py-3 px-6 rounded-lg hover:bg-gray-100 border">
                    전체 랭킹 더보기
                </a>
            </div>
        </section>
    </main>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
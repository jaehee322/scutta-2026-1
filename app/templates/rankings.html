{% extends "base.html" %}

{% block title %}{{ _('ë­í‚¹') }} - SCUTTA{% endblock %}

{% block container_style %}margin-top: 0;{% endblock %}

{% block header_left %}
<a href="{{ url_for('main.index') }}" class="text-xl font-bold truncate">
    {{ _('ë­í‚¹') }}
</a>
{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-sm p-4 h-full flex flex-col">
    <div class="flex space-x-2 mb-4 overflow-x-auto pb-2 no-scrollbar">
        <button
            class="tab-button bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap active"
            data-tab="win">{{ _('ìŠ¹ë¦¬ìˆœ') }}</button>
        <button
            class="tab-button bg-gray-100 text-gray-500 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap"
            data-tab="rate">{{ _('ìŠ¹ë¥ ìˆœ') }}</button>
        <button
            class="tab-button bg-gray-100 text-gray-500 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap"
            data-tab="match">{{ _('ê²½ê¸°ìˆ˜ìˆœ') }}</button>
        <button
            class="tab-button bg-gray-100 text-gray-500 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap"
            data-tab="achieve">{{ _('ì—…ì ìˆœ') }}</button>
        <button
            class="tab-button bg-gray-100 text-gray-500 px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap"
            data-tab="betting">{{ _('ë² íŒ…ìˆœ') }}</button>
    </div>

    <div id="ranking-container" class="flex-grow overflow-y-auto">
        <table class="table-modern w-full whitespace-nowrap">
            <thead class="sticky top-0 bg-white shadow-sm">
                <tr>
                    <th class="text-center">{{ _('ìˆœìœ„') }}</th>
                    <th>{{ _('ì´ë¦„') }}</th>
                    <th class="text-right pr-6">{{ _('ìŠ¹ë¦¬') }}</th>
                </tr>
            </thead>
            <tbody class="ranking-list" id="ranking-list-win">
                {% for p in players|sort(attribute='win_count', reverse=True) %}
                <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="location.href='/player/{{ p.id }}'">
                    <td class="text-center font-bold text-gray-500">
                        {% if loop.index == 1 %}ğŸ¥‡
                        {% elif loop.index == 2 %}ğŸ¥ˆ
                        {% elif loop.index == 3 %}ğŸ¥‰
                        {% else %}{{ loop.index }}{% endif %}
                    </td>
                    <td class="font-semibold">
                        {{ p.name }}
                        <span class="text-xs font-normal text-gray-400 ml-1">{{ p.rank or 'ë¬´' }}</span>
                    </td>
                    <td class="text-right font-bold text-blue-600 pr-4">{{ p.win_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tbody class="ranking-list hidden" id="ranking-list-rate">
                {% for p in players|sort(attribute='rate_count', reverse=True) %}
                <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="location.href='/player/{{ p.id }}'">
                    <td class="text-center font-bold text-gray-500">{{ loop.index }}</td>
                    <td class="font-semibold">{{ p.name }}</td>
                    <td class="text-right font-bold text-indigo-600 pr-4">{{ p.rate_count }}%</td>
                </tr>
                {% endfor %}
            </tbody>
            <tbody class="ranking-list hidden" id="ranking-list-match">
                {% for p in players|sort(attribute='match_count', reverse=True) %}
                <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="location.href='/player/{{ p.id }}'">
                    <td class="text-center font-bold text-gray-500">{{ loop.index }}</td>
                    <td class="font-semibold">{{ p.name }}</td>
                    <td class="text-right font-bold text-gray-800 pr-4">{{ p.match_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tbody class="ranking-list hidden" id="ranking-list-achieve">
                {% for p in players|sort(attribute='achieve_count', reverse=True) %}
                <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="location.href='/player/{{ p.id }}'">
                    <td class="text-center font-bold text-gray-500">{{ loop.index }}</td>
                    <td class="font-semibold">{{ p.name }}</td>
                    <td class="text-right font-bold text-yellow-600 pr-4">{{ p.achieve_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tbody class="ranking-list hidden" id="ranking-list-betting">
                {% for p in players|sort(attribute='betting_count', reverse=True) %}
                <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="location.href='/player/{{ p.id }}'">
                    <td class="text-center font-bold text-gray-500">{{ loop.index }}</td>
                    <td class="font-semibold">{{ p.name }}</td>
                    <td class="text-right font-bold text-green-600 pr-4">{{ p.betting_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'bg-gray-200', 'text-gray-700');
                btn.classList.add('bg-gray-100', 'text-gray-500');
            });

            button.classList.add('active', 'bg-gray-200', 'text-gray-700');
            button.classList.remove('bg-gray-100', 'text-gray-500');

            const tabName = button.dataset.tab;
            document.querySelectorAll('.ranking-list').forEach(list => list.classList.add('hidden'));
            document.getElementById(`ranking-list-${tabName}`).classList.remove('hidden');

            // ë™ì  í—¤ë” ë³€ê²½ (ì„ íƒ ì‚¬í•­)
            const headerTextMap = {
                'win': '{{ _("ìŠ¹ë¦¬") }}',
                'rate': '{{ _("ìŠ¹ë¥ ") }}',
                'match': '{{ _("ê²½ê¸°ìˆ˜") }}',
                'achieve': '{{ _("ì—…ì ") }}',
                'betting': '{{ _("ë² íŒ…") }}'
            };
            const headerCell = document.querySelector('thead th:last-child');
            if (headerCell && headerTextMap[tabName]) {
                headerCell.textContent = headerTextMap[tabName];
            }
        });
    });
</script>
{% endblock %}
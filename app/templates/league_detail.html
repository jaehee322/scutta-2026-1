{% extends "base.html" %}

{% block title %}{{ league.name }} - SCUTTA{% endblock %}

{% block container_style %}margin-top: 0;{% endblock %}

{% block header_left %}
<a href="{{ url_for('league.league') }}" class="text-xl font-bold truncate">
    {{ league.name }}
</a>
{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-sm">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-2xl font-bold">{{ league.name }} {{ _('ìˆœìœ„í‘œ') }}</h2>
        {% if current_user.is_admin %}
        <div class="flex gap-2">
            <button onclick="saveLeague({{ league.id }})"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition text-sm">
                {{ _('ë¦¬ê·¸ ì €ì¥ (ìˆœìœ„ í™•ì •)') }}
            </button>
            <button onclick="deleteLeague({{ league.id }})"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition text-sm">
                {{ _('ë¦¬ê·¸ ì‚­ì œ') }}
            </button>
        </div>
        {% endif %}
    </div>

    <div class="overflow-x-auto mb-8">
        <table class="table-modern w-full whitespace-nowrap">
            <thead>
                <tr>
                    <th class="text-center w-12">{{ _('ìˆœìœ„') }}</th>
                    <th class="text-left">{{ _('ì´ë¦„') }}</th>
                    <th class="text-center">{{ _('ìŠ¹') }}</th>
                    <th class="text-center">{{ _('íŒ¨') }}</th>
                    <th class="text-center">{{ _('ë“ì‹¤') }}</th>
                    <th class="text-center">{{ _('ìŠ¹ë¥ ') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for p in participants %}
                <tr class="{% if current_user.player_id == p.player_id %}bg-blue-50{% endif %}">
                    <td class="text-center font-bold text-lg">
                        {% if loop.index == 1 %}ğŸ¥‡
                        {% elif loop.index == 2 %}ğŸ¥ˆ
                        {% elif loop.index == 3 %}ğŸ¥‰
                        {% else %}{{ loop.index }}{% endif %}
                    </td>
                    <td class="font-semibold">{{ p.name }}</td>
                    <td class="text-center text-blue-600 font-bold">{{ p.wins }}</td>
                    <td class="text-center text-red-600 font-bold">{{ p.losses }}</td>
                    <td class="text-center text-gray-600">{{ p.score_diff }}</td>
                    <td class="text-center">{{ "%.1f"|format(p.win_rate) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <h3 class="text-xl font-bold mb-4">{{ _('ê²½ê¸° ì¼ì • ë° ê²°ê³¼') }}</h3>
    <div class="overflow-x-auto">
        <table class="table-modern w-full whitespace-nowrap">
            <thead>
                <tr>
                    <th class="text-center">{{ _('ìƒíƒœ') }}</th>
                    <th class="text-right w-1/3">{{ _('ì„ ìˆ˜ A') }}</th>
                    <th class="text-center">{{ _('ìŠ¤ì½”ì–´') }}</th>
                    <th class="text-left w-1/3">{{ _('ì„ ìˆ˜ B') }}</th>
                    <th class="text-center">{{ _('ì¡°ì‘') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for match in matches %}
                <tr class="hover:bg-gray-50">
                    <td class="text-center">
                        {% if match.status == 'completed' %}
                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">{{
                            _('ì¢…ë£Œ') }}</span>
                        {% else %}
                        <span class="px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-800 rounded-full">{{ _('ì§„í–‰ì¤‘')
                            }}</span>
                        {% endif %}
                    </td>
                    <td class="text-right">
                        <span class="{% if match.winner_id == match.p1_id %}font-bold text-blue-600{% endif %}">
                            {{ match.p1_name }}
                        </span>
                    </td>
                    <td class="text-center font-bold px-4">
                        {% if match.status == 'completed' %}
                        {{ match.score_p1 }} : {{ match.score_p2 }}
                        {% else %}
                        vs
                        {% endif %}
                    </td>
                    <td class="text-left">
                        <span class="{% if match.winner_id == match.p2_id %}font-bold text-blue-600{% endif %}">
                            {{ match.p2_name }}
                        </span>
                    </td>
                    <td class="text-center">
                        {% if match.status != 'completed' %}
                        {% if current_user.is_admin or current_user.player_id == match.p1_id or current_user.player_id
                        == match.p2_id %}
                        <a href="{{ url_for('league.league_submit_match_page', league_id=league.id, opponent_id=(match.p2_id if current_user.player_id == match.p1_id else match.p1_id)) }}"
                            class="bg-main button text-xs py-1 px-2">
                            {{ _('ê²°ê³¼ ì…ë ¥') }}
                        </a>
                        {% endif %}
                        {% elif current_user.is_admin %}
                        <form action="{{ url_for('league.revert_league_match', league_id=league.id) }}" method="POST"
                            onsubmit="return confirm('{{ _('ì •ë§ ì´ ê²½ê¸° ê²°ê³¼ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?') }}');">
                            <input type="hidden" name="match_id" value="{{ match.id }}">
                            <button type="submit"
                                class="text-xs text-red-500 hover:text-red-700 font-semibold underline">{{ _('ê²°ê³¼ ì·¨ì†Œ')
                                }}</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/league_detail.js') }}"></script>
{% endblock %}
{% extends "base.html" %}

{% block title %}경기 승인 관리 - SCUTTA{% endblock %}

{% block container_style %}margin-top: 0;{% endblock %}

{% block header_left %}
<a href="{{ url_for('main.index') }}" class="text-lg font-bold truncate">
    경기 승인 관리
</a>
{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-sm">
    <h2 class="text-2xl font-bold mb-6">승인 대기 중인 경기</h2>

    <form action="{{ url_for('admin.approve_selected_matches') }}" method="POST">
        <div class="overflow-x-auto">
            <table class="table-modern w-full whitespace-nowrap">
                <thead>
                    <tr>
                        <th class="w-10 text-center">
                            <input type="checkbox" id="check-all" class="h-4 w-4 rounded border-gray-300">
                        </th>
                        <th class="text-center">시간</th>
                        <th class="text-center">승자</th>
                        <th class="text-center">패자</th>
                        <th class="text-center">스코어</th>
                        <th class="text-center">관리</th>
                    </tr>
                </thead>
                <tbody>
                    {% if pending_matches %}
                    {% for match in pending_matches %}
                    <tr>
                        <td class="text-center">
                            <input type="checkbox" name="match_ids" value="{{ match.id }}"
                                class="match-checkbox h-4 w-4 rounded border-gray-300">
                        </td>
                        <td class="text-center text-sm text-gray-500">
                            {{ match.timestamp.strftime('%m.%d %H:%M') }}
                        </td>
                        <td class="text-center font-bold text-blue-600">
                            {{ match.winner_name }}
                        </td>
                        <td class="text-center font-bold text-red-600">
                            {{ match.loser_name }}
                        </td>
                        <td class="text-center font-bold">
                            {{ match.score }}
                        </td>
                        <td class="text-center">
                            <div class="flex justify-center gap-2">
                                <button type="submit"
                                    formaction="{{ url_for('match.approve_match', match_id=match.id) }}"
                                    class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">승인</button>
                                <button type="submit"
                                    formaction="{{ url_for('match.delete_match_by_admin', match_id=match.id) }}"
                                    class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600"
                                    onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            승인 대기 중인 경기가 없습니다.
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        {% if pending_matches %}
        <div class="mt-4 flex gap-2">
            <button type="submit"
                class="bg-blue-600 text-white font-bold py-2 px-6 rounded hover:bg-blue-700 transition">선택 일괄
                승인</button>
        </div>
        {% endif %}
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.getElementById('check-all').addEventListener('change', function () {
        const checkboxes = document.querySelectorAll('.match-checkbox');
        checkboxes.forEach(cb => cb.checked = this.checked);
    });
</script>
{% endblock %}
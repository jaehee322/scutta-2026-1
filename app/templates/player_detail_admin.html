<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ player.name }} - 상세 정보</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-gray-100">

    <header>
        <div class="flex-shrink-0 w-1/4">
            <button class="text-2xl p-4 -ml-4" onclick="history.back()">&larr;</button>
        </div>
        <div class="flex-grow min-w-0 text-center">
            <a href="{{ url_for('index') }}" class="text-lg font-bold truncate">{{ player.name }}</a>
        </div>
        <div class="flex-shrink-0 w-1/4 flex justify-end items-center gap-2">
           {% if current_user.is_authenticated %}
                <a href="{{ url_for('mypage') }}" class="text-sm font-semibold hover:underline truncate">{{ current_user.username }}</a>
                <a href="{{ url_for('logout') }}" class="bg-gray-200 hover:bg-gray-300 text-sm text-gray-800 py-1 px-2 rounded-md whitespace-nowrap">로그아웃</a>
            {% endif %}
        </div>
    </header>

    <div class="container mx-auto p-4" style="margin-top:0;">
        <div class="bg-white shadow p-6 rounded">
            <h2 class="text-lg font-bold mb-4">{{ player.rank or '무' }}부</h2>
            <table class="table-modern">
                <tr>
                    <td class="bg-gray-100 border p-2">승리</td>
                    <td class="border p-2">{{ player.win_count }}</td>
                    <td class="border p-2">{{ player.win_order or ' ' }}위</td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2">패배</td>
                    <td class="border p-2">{{ player.loss_count }}</td>
                    <td class="border p-2">{{ player.loss_order or ' ' }}위</td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2">승률</td>
                    <td class="border">{{ player.rate_count }} %</td>
                    <td class="border">{{ player.rate_order or ' ' }}위</td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2">경기</td>
                    <td class="border p-2">{{ player.match_count }} 경기</td>
                    <td class="border p-2">{{ player.match_order or ' ' }}위</td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2">상대</td>
                    <td class="border p-2">{{ player.opponent_count }}명</td>
                    <td class="border p-2">{{ player.opponent_order or ' ' }}위</td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2">업적</td>
                    <td class="border p-2">{{ player.achieve_count }}점</td>
                    <td class="border p-2">{{ player.achieve_order or ' ' }}위</td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2">베팅</td>
                    <td class="border p-2">{{ player.betting_count }}점</td>
                    <td class="border p-2">{{ player.betting_order or ' ' }}위</td>
                </tr>
            </table>

            <h2 class="text-lg font-bold my-4">업적 달성 보드</h2>
            <table class="table-modern">
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">날이 좋아서</td>
                    <td class="bg-gray-100 border p-2 font-bold">5점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 30경기 달성</td>
                    <td class="border p-2">
                        {% if player.match_count < 30 %}
                            {{ (player.match_count * 100 / 30)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">날이 좋지 않아서</td>
                    <td class="bg-gray-100 border p-2 font-bold">10점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 50경기 달성</td>
                    <td class="border p-2">
                        {% if player.match_count < 50 %}
                            {{ (player.match_count * 100 / 50)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">날이 적당해서</td>
                    <td class="bg-gray-100 border p-2 font-bold">20점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 70경기 달성</td>
                    <td class="border p-2">
                        {% if player.match_count < 70 %}
                            {{ (player.match_count * 100 / 70)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">모든 날이 탁구였다...</td>
                    <td class="bg-gray-100 border p-2 font-bold">30점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 100경기 달성</td>
                    <td class="border p-2">
                        {% if player.match_count < 100 %}
                            {{ player.match_count }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
            </table>

            <table class="table-modern mt-4">
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">내가 나가</td>
                    <td class="bg-gray-100 border p-2 font-bold">10점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 30승 달성</td>
                    <td class="border p-2">
                        {% if player.win_count < 30 %}
                            {{ (player.win_count * 100 / 30)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">내가 잘 나가</td>
                    <td class="bg-gray-100 border p-2 font-bold">20점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 50승 달성</td>
                    <td class="border p-2">
                        {% if player.win_count < 50 %}
                            {{ (player.win_count * 100 / 50)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">내가 제일 잘 나가</td>
                    <td class="bg-gray-100 border p-2 font-bold">30점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 70승 달성</td>
                    <td class="border p-2">
                        {% if player.win_count < 70 %}
                            {{ (player.win_count * 100 / 70)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
            </table>

            <table class="table-modern mt-4">
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">숨 참고 Scutta Dive~</td>
                    <td class="bg-gray-100 border p-2 font-bold">10점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 30패 달성</td>
                    <td class="border p-2">
                        {% if player.loss_count < 30 %}
                            {{ (player.loss_count * 100 / 30)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">Under The Sea~</td>
                    <td class="bg-gray-100 border p-2 font-bold">20점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 50패 달성</td>
                    <td class="border p-2">
                        {% if player.loss_count < 50 %}
                            {{ (player.loss_count * 100 / 50)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">해저 2만 리</td>
                    <td class="bg-gray-100 border p-2 font-bold">30점</td>
                </tr>
                <tr>
                    <td class="border p-2">누적 70패 달성</td>
                    <td class="border p-2">
                        {% if player.loss_count < 70 %}
                            {{ (player.loss_count * 100 / 70)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
            </table>

            <table class="table-modern mt-4">
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">단어장 마스터</td>
                    <td class="bg-gray-100 border p-2 font-bold">10점</td>
                </tr>
                <tr>
                    <td class="border p-2">상대수 10명 달성</td>
                    <td class="border p-2">
                        {% if player.opponent_count < 10 %}
                            {{ (player.opponent_count * 100 / 10)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">인물사전 마스터</td>
                    <td class="bg-gray-100 border p-2 font-bold">20점</td>
                </tr>
                <tr>
                    <td class="border p-2">상대수 30명 달성</td>
                    <td class="border p-2">
                        {% if player.opponent_count < 30 %}
                            {{ (player.opponent_count * 100 / 30)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="bg-gray-100 border p-2 font-bold">백과사전 마스터</td>
                    <td class="bg-gray-100 border p-2 font-bold">30점</td>
                </tr>
                <tr>
                    <td class="border p-2">상대수 50명 달성</td>
                    <td class="border p-2">
                        {% if player.opponent_count < 50 %}
                            {{ (player.opponent_count * 100 / 50)|round(1) }}%
                        {% else %}
                            달성
                        {% endif %}
                    </td>
                </tr>
            </table>

            <section class="pt-6">
                <h3 class="text-xl font-bold mb-4">포인트 변경 기록</h3>
                <div class="overflow-x-auto">
                    <table class="table-modern">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="py-2 px-4 border-b">시간</th>
                                <th class="py-2 px-4 border-b">변경 사유</th>
                                <th class="py-2 px-4 border-b">업적 포인트</th>
                                <th class="py-2 px-4 border-b">베팅 포인트</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in point_logs %}
                            <tr class="text-center text-sm">
                                <td class="py-2 px-4 border-b whitespace-nowrap">{{ log.timestamp.strftime('%m.%d %H:%M') }}</td>
                                <td class="py-2 px-4 border-b">{{ log.reason }}</td>
                                <td class="py-2 px-4 border-b font-semibold">
                                    {% if log.achieve_change > 0 %}<span class="text-blue-600">+{{ log.achieve_change }}</span>
                                    {% elif log.achieve_change < 0 %}<span class="text-red-600">{{ log.achieve_change }}</span>
                                    {% else %}<span class="text-gray-400">-</span>{% endif %}
                                </td>
                                <td class="py-2 px-4 border-b font-semibold">
                                    {% if log.betting_change > 0 %}<span class="text-blue-600">+{{ log.betting_change }}</span>
                                    {% elif log.betting_change < 0 %}<span class="text-red-600">{{ log.betting_change }}</span>
                                    {% else %}<span class="text-gray-400">-</span>{% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="4" class="py-4 px-4 text-center text-gray-500">포인트 변경 기록이 없습니다.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
</body>
</html>